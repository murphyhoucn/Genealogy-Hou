# YAML å¯¼å…¥é€»è¾‘è¯´æ˜

## ğŸ“Œ æ ¸å¿ƒæ¦‚å¿µ

### YAML ä¸­çš„å­—æ®µ vs æ•°æ®åº“ä¸­çš„å­—æ®µ

| YAML å­—æ®µ | å«ä¹‰ | æ•°æ®åº“å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|----------|------|-----------|------|------|
| `uid` | æˆå‘˜çš„å”¯ä¸€æ ‡è¯†ç¬¦ | `uid` | `text` | å¦‚ `G21-7zZJUY` |
| `father_id` | **çˆ¶è¾ˆçš„ uid** | `father_id` | `bigint` | **å­˜å‚¨çˆ¶è¾ˆçš„æ•°æ®åº“ ID** |

## âš ï¸ é‡è¦ç†è§£

### YAML ä¸­çš„ `father_id`

```yaml
- uid: G22-jeJwMi          # è¿™ä¸ªæˆå‘˜çš„å”¯ä¸€æ ‡è¯†
  name: ä¾¯é‡‘è‰¯
  father_id: G21-7zZJUY    # â† è¿™æ˜¯çˆ¶äº²çš„ uidï¼ˆå­—ç¬¦ä¸²ï¼‰
```

**è¿™é‡Œçš„ `father_id` å®é™…å«ä¹‰æ˜¯ "çˆ¶äº²çš„ uid"**

### æ•°æ®åº“ä¸­çš„ `father_id`

æ•°æ®åº“è¡¨ç»“æ„ï¼š
```
| id (bigint) | name | uid (text) | father_id (bigint) |
|-------------|------|------------|-------------------|
| 182         | ä¾¯æˆåŠŸ | G21-7zZJUY | 150               |
| 301         | ä¾¯é‡‘è‰¯ | G22-jeJwMi | 182               | â† å­˜å‚¨çš„æ˜¯çˆ¶äº²çš„æ•°æ®åº“ ID
```

**æ•°æ®åº“çš„ `father_id` å¿…é¡»æ˜¯æ•°å­—ï¼ˆçˆ¶è¾ˆè®°å½•çš„ `id`ï¼‰æ‰èƒ½å»ºç«‹å¤–é”®å…³ç³»**

## ğŸ”„ å¯¼å…¥åŒ¹é…æµç¨‹

### æ­¥éª¤ 1ï¼šå»ºç«‹æ˜ å°„è¡¨

å¯¼å…¥å‰å…ˆæŸ¥è¯¢æ‰€æœ‰å·²å­˜åœ¨æˆå‘˜ï¼š
```typescript
const { data: existingMembers } = await supabase
  .from("family_members")
  .select("id, uid, name");

// å»ºç«‹ uid â†’ æ•°æ®åº“ id çš„æ˜ å°„
fatherIdMap = {
  "G21-7zZJUY": 182,  // uid â†’ æ•°æ®åº“ ID
  "G20-HAhsp2": 150,
  ...
}
```

### æ­¥éª¤ 2ï¼šè§£æ YAML çš„ father_id

```yaml
father_id: G21-7zZJUY   # YAML ä¸­æ˜¯çˆ¶äº²çš„ uid
```

â†“ æŸ¥æ‰¾æ˜ å°„è¡¨

```typescript
fatherIdMap["G21-7zZJUY"] â†’ 182
```

â†“ æ’å…¥æ•°æ®åº“

```sql
INSERT INTO family_members (name, father_id, uid)
VALUES ('ä¾¯é‡‘è‰¯', 182, 'G22-jeJwMi')
       --          â†‘ è¿™é‡Œå­˜å‚¨çš„æ˜¯çˆ¶äº²çš„æ•°æ®åº“ ID
```

### æ­¥éª¤ 3ï¼šæ‰¹æ¬¡å¤„ç†

**æƒ…å†µ Aï¼šçˆ¶äº²å·²å­˜åœ¨**
```
å¯¼å…¥ YAML â†’ æŸ¥æ‰¾ father_id (uid) â†’ æ‰¾åˆ°æ•°æ®åº“ ID â†’ ç›´æ¥æ’å…¥
```

**æƒ…å†µ Bï¼šçˆ¶äº²ä¸åœ¨å½“å‰æ‰¹æ¬¡**
```
æœ¬æ‰¹æ¬¡è·³è¿‡ â†’ ä¸‹ä¸€æ‰¹æ¬¡é‡æ–°å°è¯• â†’ ç›´åˆ°æ‰€æœ‰çˆ¶è¾ˆéƒ½å¯¼å…¥
```

## ğŸ“Š æŸ¥çœ‹æ•°æ®åº“æ—¶çš„ç†è§£

Supabase æ§åˆ¶å°æ˜¾ç¤ºï¼š

```
| name  | uid        | father_id |
|-------|------------|-----------|
| ä¾¯æˆåŠŸ | G21-7zZJUY | 150       | â† father_id æ˜¯æ•°å­— ID
| ä¾¯é‡‘è‰¯ | G22-jeJwMi | 182       | â† æŒ‡å‘ä¾¯æˆåŠŸçš„æ•°æ®åº“ ID (182)
```

**è¿™æ˜¯æ­£ç¡®çš„ï¼** `father_id` **å¿…é¡»**æ˜¯æ•°å­—æ‰èƒ½å»ºç«‹æ•°æ®åº“å…³ç³»ã€‚

å¦‚æœæƒ³çœ‹çˆ¶äº²çš„ `uid`ï¼Œéœ€è¦å…³è”æŸ¥è¯¢ï¼š
```sql
SELECT 
  m.name,
  m.uid,
  f.uid as father_uid     â† çˆ¶äº²çš„ uid
FROM family_members m
LEFT JOIN family_members f ON m.father_id = f.id
```

## âœ… å­—æ®µå‘½åæ€»ç»“

| ä½ç½® | å­—æ®µå | å®é™…å­˜å‚¨å†…å®¹ | æ•°æ®ç±»å‹ |
|------|--------|------------|---------|
| YAML | `uid` | æˆå‘˜çš„å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚ `G22-jeJwMi`ï¼‰ | string |
| YAML | `father_id` | **çˆ¶è¾ˆçš„ uid**ï¼ˆå¦‚ `G21-7zZJUY`ï¼‰ | string |
| æ•°æ®åº“ | `uid` | æˆå‘˜çš„å”¯ä¸€æ ‡è¯†ï¼ˆä» YAML çš„ `uid` å¯¼å…¥ï¼‰ | text |
| æ•°æ®åº“ | `father_id` | **çˆ¶è¾ˆçš„æ•°æ®åº“ ID**ï¼ˆæŸ¥æ‰¾å¾—åˆ°ï¼‰ | bigint |

## ğŸ¯ å…³é”®ç‚¹

1. **YAML çš„ `father_id` ä¸ä¼šç›´æ¥å­˜å…¥æ•°æ®åº“**ï¼Œå®ƒç”¨äºæŸ¥æ‰¾çˆ¶è¾ˆçš„æ•°æ®åº“ ID
2. **æ•°æ®åº“çš„ `father_id` æ˜¯å¤–é”®**ï¼Œå¿…é¡»æŒ‡å‘ `family_members.id`
3. **æ˜¾ç¤ºçˆ¶å­å…³ç³»æ—¶**ï¼Œå‰ç«¯ä¼šè‡ªåŠ¨é€šè¿‡ `father_id` å…³è”æŸ¥è¯¢çˆ¶è¾ˆä¿¡æ¯

è¿™ç§è®¾è®¡æ˜¯æ ‡å‡†çš„å…³ç³»å‹æ•°æ®åº“åšæ³•ï¼Œä¿è¯äº†æ•°æ®å®Œæ•´æ€§å’ŒæŸ¥è¯¢æ•ˆç‡ã€‚
